<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "MainList">
	
	<!-- 펜션 리스트 -->
	   
	<select id="penList" resultType="Map" parameterType="int">
		<![CDATA[
			select p.name,
			       p.law_name,
			       p.law_code,
			       p.visit_road3,
			       pi.image_path,
			       pr.price
			from pension p, (select image_path 
			                    from pension_image  
			                    where RoWNUM = 1) pi, rooms rm, (select pr.price,
			                                                            pr.no
			                                                    from prices pr
			                                                    GROUP BY pr.no, pr.price
			                                                    having pr.price = min(pr.price)) pr
			where p.no = rm.no
			and rm.no = pr.no
			and p.law_code = #{areaNo}
		]]>
	</select>
	<!--  
	<select id="searchList" resultType="Map" parameterType="com.javaex.vo.MainSearchVo">
		<![CDATA[
			select p.name,
			       p.law_name,
			       p.law_code,
			       p.visit_road3,
			       pi.image_path,
			       pr.price,
			       re.status,
			       pa.s_amenities_no,
			       pp.s_public_no
			from pension p, reservations re, reviews ri, p_amenities pa, p_public pp, (select image_path 
			                    from pension_image  
			                    where RoWNUM = 1) pi, rooms rm, (select pr.price,
			                                                            pr.no
			                                                    from prices pr
			                                                    GROUP BY pr.no, pr.price
			                                                    having pr.price = min(pr.price)) pr
			where p.no = rm.no
			and rm.no = pr.no
			and re.no = rm.no
			and re.no = ri.review_no
			and p.no = pa.pension_no
			and p.no = pp.pension_no
			and pa.s_amenities_no BETWEEN #{searchFirst} and #{searchLast}
			
		]]>
	</select>
	-->
	<select id="searchList" resultType="Map" parameterType="com.javaex.vo.MainSearchVo">
		<![CDATA[
			select  p.name,
			        p.law_name,
			        p.law_code,
			        p.visit_road3,
			        pi.image_path,
			        pr.price,
			        re.status,
			        pa.s_amenities_no,
			        pp.s_public_no,
			        rm.standard_people
			        
			 from pension p, reservations re, reviews ri, gugun gu, sido si, p_amenities pa, p_public pp,
		 			(select image_path 
	                  from pension_image  
	                  where RoWNUM = 1) pi,
	                 rooms rm, (select pr.price,
                                       pr.no
                               from prices pr
                               GROUP BY pr.no, pr.price
                               having pr.price = min(pr.price)) pr
			 where p.no = rm.no
			 and rm.no = pr.no
			 and re.no = rm.no
			 and re.no = ri.review_no
			 and p.no = si.no
			 and si.no = gu.no
			 and p.no = pa.pension_no
			 and p.no = pp.pension_no
			 and rm.standard_people = #{persons}
			 
			 and re.check_in = #{datepicker}
			 and re.check_out = #{datepicker2}
		 ]]>
		 <foreach collection="pensionItem1" item="pensionItems1">
			<![CDATA[
				and pa.s_amenities_no = #{pensionItems1}
			]]>
		</foreach>
		
		 <foreach collection="pensionItem2" item="pensionItems2">
			<![CDATA[
				 and pp.s_public_no = #{pensionItems2}
			]]>
		</foreach>
		 	 
		
		
	</select>
	
</mapper>