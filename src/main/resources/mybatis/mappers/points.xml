<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="points">

	<select id="getpoint" parameterType="int" resultType="Map">
		SELECT
			NVL(sum(POINT), 0) POINTS
		FROM
			POINTS POINTS,
			RESERVATIONS RESERVATIONS,
			USERS USERS
		WHERE 1 = 1
		 AND POINTS.RESERVE_NO = RESERVATIONS.NO
		 AND POINTS.NO = USERS.NO
		 AND RESERVATIONS.user_no = #{userNo}

	</select> 
	

	 <insert id="pointsInsert" parameterType="com.javaex.vo.RePayVo">
			 <selectKey keyProperty="pointNo" resultType="int" order="BEFORE">
			    	select SEQ_POINTS_NO.NEXTVAL FROM DUAL
		  	 </selectKey>
				INSERT INTO POINTS (
						NO,
						RESERVE_NO,
						POINT,
						REG_DATE )
				VALUES (
				  		#{pointNo},
						#{no}, <!-- RESERVE_NO입니다 -->
						TO_NUMBER('-'||#{point}),
						SYSDATE
						)
	</insert> 
	

</mapper>