<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "MainList">
	
	<!-- 펜션 리스트 -->
	  
	<select id="penList" resultType="Map" parameterType="int">
		<![CDATA[
			select          
					        ri.rcount,
					        p.no pNo,
					        p.name pName,
					        p.law_name lawName,
					        p.law_code lawCode,
					        p.visit_road3  visitRoad3,
					        pi.image_path imagePath,
					        pr.price penPrice,
					        ri.stars stars ,
					        re.status status
					from pension p, (select rownum
					                        ,rn.image_path image_path
					                        ,rn.pension_no
					                from(select 
					                        image_path
					                        ,pension_no
					                from pension_image
					                order by no asc) rn) pi, rooms r, (select min(p.price) price
					                                                    from prices p, rooms r
					                                                    where p.room_no = r.no
					                                                    and r.pension_no = 1) pr, reservations re,(select round(avg(ri.stars),1) stars
					                                                                                                        ,count(review_no) rcount
					                                                                                                from reviews ri, reservations re, rooms r
					                                                                                                where ri.no = re.no
					                                                                                                and re.room_no = r.no
					                                                                                                and r.pension_no = 1) ri    
					where p.no = pi.pension_no
					and p.company_no = r.pension_no
					and r.no = re.no
					and rownum = 1
					GROUP by p.name ,
					         p.law_name ,
					         p.law_code ,
					         p.visit_road3 ,
					         pi.image_path ,
					         pr.price ,
					         ri.stars ,
					         ri.rcount,
					         re.status,
					         p.no
					having p.law_code = #{areaNo}
		]]>
	</select>
		
	<!-- 날짜 검색시 리스트 -->
	<select id="dateList" resultType="Map" parameterType="Map">
		<![CDATA[
			select          
					        ri.rcount,
					        p.no pNo,
					        p.name pName,
					        p.law_name lawName,
					        p.law_code lawCode,
					        p.visit_road3  visitRoad3,
					        pi.image_path imagePath,
					        pr.price penPrice,
					        ri.stars stars ,
					        re.status status
					from pension p, (select rownum
					                        ,rn.image_path image_path
					                        ,rn.pension_no
					                from(select 
					                        image_path
					                        ,pension_no
					                from pension_image
					                order by no asc) rn) pi, rooms r, (select min(p.price) price
					                                                    from prices p, rooms r
					                                                    where p.room_no = r.no
					                                                    and r.pension_no = 1) pr, reservations re,(select round(avg(ri.stars),1) stars
					                                                                                                        ,count(review_no) rcount
					                                                                                                from reviews ri, reservations re, rooms r
					                                                                                                where ri.no = re.no
					                                                                                                and re.room_no = r.no
					                                                                                                and r.pension_no = 1) ri    
					where p.no = pi.pension_no
					and p.company_no = r.pension_no
					and r.no = re.no
					and rownum = 1
					GROUP by p.name ,
					         p.law_name ,
					         p.law_code ,
					         p.visit_road3 ,
					         pi.image_path ,
					         pr.price ,
					         ri.stars ,
					         ri.rcount,
					         re.status,
					         p.no,
                             re.check_in,
                             re.check_out
					having p.law_code = #{areaNo}
                    and re.check_in = #{datepicker}
                    and re.check_out = #{datepicker2}
		]]>
	</select>
	
</mapper>