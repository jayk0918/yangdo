<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="detail">
	
	<!-- 펜션정보 가져오기 -->
	<select id="select" resultType="map" parameterType="int">
		<![CDATA[
			select  p.no
			        ,p.company_no
			        ,p.name
			        ,p.postal_code
			        ,p.address
			        ,p.detail_address
			        ,p.law_code
			        ,p.law_name
			        ,p.visit_road1
			        ,p.visit_road2
			        ,p.visit_road3
			        ,p.area_info1
			        ,p.area_info2
			        ,p.area_info3
			        ,p.rules
			        ,p.live_pay livePay
			        ,p.parking_info
			        ,p.etc
			        ,p.check_in
			        ,p.check_out
			        ,p.add_adult_price
			        ,p.add_kid_price
			        ,p.add_baby_price
			        ,p.refund_no
			from    pension p
			where   p.no = #{pensionNo}
		]]>
	</select>
	
	<!-- 평점 및 총 리뷰개수 -->
	<select id = "totalReview" resultType="map" parameterType="int">
		<![CDATA[
			select  to_char(avg(re.stars), '0.0') avgStars
			        ,count(re.review_no) rCount
			from    reservations res, reviews re, users u, company c, pension p
			where   res.no = re.no
			and     u.no = res.user_no
			and     u.no = c.no
			and     c.no = p.company_no
			and     p.no = #{pensionNo}
		]]>
	</select>
	
	<!-- 이미지 리스트 -->
	<select id="selectList" resultType="map" parameterType="map">
		<![CDATA[
				select  ort.rn RN
				        ,ort.no
				        ,ort.pension_no
				        ,ort.image_path
				        ,ort.orders
				from    (select  rownum rn
				                 ,ot.no
				                 ,ot.pension_no
				                 ,ot.image_path
				                 ,ot.orders
				         from    (select  p.no
				                          ,p.pension_no
				                          ,p.image_path
				                          ,p.orders
				                  from    pension_image p
				                  order by no asc) ot
				         )ort
				where   ort.rn >= #{startRnum}
				and     ort.rn <= #{endRnum}
				and		pension_no = #{pensionNo}
		]]>
	</select>
	
	<!-- 전체글갯수 구하기 -->
	<select id="selectTotalCnt" resultType="int" parameterType="int">
		<![CDATA[
			select  count(*) count
			from    pension_image
			where	pension_no = #{pensionNo}
		]]>
	</select>
	
	<!-- 편의시설 리스트 -->
	<select id="pAmenList" resultType="map" parameterType="int">
		<![CDATA[
			select  sAmen.no
					,sAmen.name
					,sAmen.ICON_PATH
			from    pension p, p_amenities pAmen, s_amenities sAmen
			where   p.no = pAmen.pension_no
			and     pAmen.s_amenities_no = sAmen.no
			and     p.no = #{pensionNo}
		]]>
	</select>
	
	<!-- 공용시설 리스트 -->
	<select id="pPubList" resultType="map" parameterType="int">
		<![CDATA[
			select  sPub.no
					,sPub.name
					,sPub.ICON_PATH
			from    pension p, p_public pPub, s_public sPub
			where   p.no = pPub.pension_no
			and     pPub.s_public_no = sPub.no
			and     p.no = #{pensionNo}
		]]>
	</select>
	
	
	<!-- 객실 방 번호 리스트 가져오기 -->
	<select id="roomNo" resultType="map" parameterType="int">
		<![CDATA[
			select  res.room_no
			from    reservations res, rooms r, pension p
			where   res.room_no = r.no
			and     r.pension_no = p.no
			and     status = '예약완료'
			or      status = '양도대기'
			and     p.no = #{pensionNo}
			group by res.room_no
			order by res.room_no asc
		]]>
	</select>
	
	<!-- 예약객실 리스트 가져오기 -->
	<select id="reservation" resultType="map" parameterType="int">
		<![CDATA[
			select  res.no
			        ,res.room_no
			        ,res.user_no
			        ,res.name
			        ,res.hp
			        ,res.check_in
			        ,res.check_out
			        ,res.adult
			        ,res.kid
			        ,res.baby
			        ,res.total_price
			        ,res.reg_date
			        ,res.pay_way
			        ,res.pay_status
			        ,res.status
			        ,res.trans_price
			        ,r.pension_no
                    ,r.room_name
                    ,r.no
                    ,r.standard_people
                    ,r.max_people
                    ,r.add_info
			from    reservations res, rooms r, pension p
			where   res.room_no(+) = r.no
			and     r.pension_no = p.no
			and     p.no = #{pensionNo}
			and     (res.status = '예약완료' or res.status = '양도대기')
			order by res.no asc
		]]>
		
	</select>
</mapper>