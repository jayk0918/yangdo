<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="my">

	<!-- 유저 번호로 전체 리스트 가져오기 -->
	<select id="getUserList" resultType="com.javaex.vo.MyListVo"
		parameterType="int">
		<![CDATA[
			select r.user_no no,
				   r.no resNo,
				   r.status status,
                   p.name pName,
                   to_char(r.check_in, 'yyyy-mm-dd DY') checkIn,
                   to_char(r.check_out, 'yyyy-mm-dd DY') checkOut,
                   p.check_in inTime,
                   p.check_out outTime,
                   r.reg_date regDate
            from reservations r, pension p, rooms ro
			where r.room_no = ro.no
			and p.no = ro.pension_no
			and r.user_no = #{no}
			order by r.no desc
		]]>
	</select>

	<!-- 유저 번호로 예약완료 리스트 가져오기 -->
	<select id="getReserveList" resultType="com.javaex.vo.MyListVo"
		parameterType="int">
		<![CDATA[
			select r.user_no no,
				   r.no resNo,
				   r.status status,
                   p.name pName,
                   to_char(r.check_in, 'yyyy-mm-dd DY') checkIn,
                   to_char(r.check_out, 'yyyy-mm-dd DY') checkOut,
                   p.check_in inTime,
                   p.check_out outTime,
                   r.reg_date regDate
            from reservations r, pension p, rooms ro
			where r.room_no = ro.no
			and p.no = ro.pension_no
			and r.user_no = #{no}
			and r.status = '예약완료'
			order by r.no desc
		]]>
	</select>

	<!-- 유저 번호로 이용완료 리스트 가져오기 -->
	<select id="getUsedList" resultType="com.javaex.vo.MyListVo"
		parameterType="int">
		<![CDATA[
			select r.user_no no,
				   r.no resNo,
				   r.status status,
                   p.name pName,
                   to_char(r.check_in, 'yyyy-mm-dd DY') checkIn,
                   to_char(r.check_out, 'yyyy-mm-dd DY') checkOut,
                   p.check_in inTime,
                   p.check_out outTime,
                   r.reg_date regDate
            from reservations r, pension p, rooms ro
			where r.room_no = ro.no
			and p.no = ro.pension_no
			and r.user_no = #{no}
			and r.status = '이용완료'
			order by r.no desc
		]]>
	</select>

	<!-- 유저 번호로 예약취소 리스트 가져오기 -->
	<select id="getCancelList" resultType="com.javaex.vo.MyListVo"
		parameterType="int">
		<![CDATA[
			select r.user_no no,
				   r.no resNo,
				   r.status status,
                   p.name pName,
                   to_char(r.check_in, 'yyyy-mm-dd DY') checkIn,
                   to_char(r.check_out, 'yyyy-mm-dd DY') checkOut,
                   p.check_in inTime,
                   p.check_out outTime,
                   r.reg_date regDate
            from reservations r, pension p, rooms ro
			where r.room_no = ro.no
			and p.no = ro.pension_no
			and r.user_no = #{no}
			and r.status = '예약취소'
			order by r.no desc
		]]>
	</select>

	<!-- 유저 번호로 양도대기 리스트 가져오기 -->
	<select id="getRelistList" resultType="com.javaex.vo.MyListVo"
		parameterType="int">
		<![CDATA[
			select r.user_no no,
				   r.no resNo,
				   r.status status,
                   p.name pName,
                   to_char(r.check_in, 'yyyy-mm-dd DY') checkIn,
                   to_char(r.check_out, 'yyyy-mm-dd DY') checkOut,
                   p.check_in inTime,
                   p.check_out outTime,
                   r.reg_date regDate
            from reservations r, pension p, rooms ro
			where r.room_no = ro.no
			and p.no = ro.pension_no
			and r.user_no = #{no}
			and r.status = '양도대기'
			order by r.no desc
		]]>
	</select>

	<!-- 유저 번호로 양도완료 리스트 가져오기 -->
	<select id="getTransferList" resultType="com.javaex.vo.MyListVo"
		parameterType="int">
		<![CDATA[
			select r.user_no no,
				   r.no resNo,
				   r.status status,
                   p.name pName,
                  to_char(r.check_in, 'yyyy-mm-dd DY') checkIn,
                   to_char(r.check_out, 'yyyy-mm-dd DY') checkOut,
                   p.check_in inTime,
                   p.check_out outTime,
                   r.reg_date regDate
            from reservations r, pension p, rooms ro
			where r.room_no = ro.no
			and p.no = ro.pension_no
			and r.user_no = #{no}
			and r.status = '양도완료'
			order by r.no desc
		]]>
	</select>

	<!-- 예약내역(이용완료/예약취소/양도완료) 삭제 (예약번호->no) -->
	<delete id="deleteOne" parameterType="int">
		<![CDATA[
			delete from reservations
			where resNo = #{resNo}
		]]>
	</delete>

	<!-- 예약상태 업데이트 하기 -->
	<update id="updateStatus" parameterType="int">
		<![CDATA[
			update reservations
			set status=#{status}
			where resNo = #{resNo}
		]]>
	</update>

	<!-- 예약상세 페이지 예약번호로 불러오기 -->
	<select id="getDetail" resultType="com.javaex.vo.MyListVo"
		parameterType="int">
		<![CDATA[
 			select r.status status,
 					p.name pName,
 					ro.room_name rName,
 					to_char(r.check_in, 'yyyy-mm-dd DY') checkIn,
                   to_char(r.check_out, 'yyyy-mm-dd DY') checkOut,
 					p.check_in inTime,
 					p.check_out outTime,
 					ro.standard_people sPple,
 					ro.max_people mPple,
 					r.no resNo,
 					r.name,
 					r.hp,
 					r.total_price tPrice,
 					r.trans_price trPrice,
 					r.pay_status pStatus,
 					p.refund_no refNo,
 					co.company_hp comHp,
 					r.p_r_no pRno
 			from reservations r, pension p, rooms ro, company co
 			where r.room_no = ro.no
 			and p.no = ro.pension_no
            and co.no = p.company_no
 			and r.no = #{resNo}
		]]>
	</select>
</mapper>